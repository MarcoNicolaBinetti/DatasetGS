---
title: "Untitled"
author: "MNB"
date: "12/4/2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraires
```{r}
library(readxl)       # Import Excel files (.xls, .xlsx)
library(ggplot2)      # Grammar-of-graphics plotting
library(ggtext)   # for bold axis labels
library(tidyverse)    # Data wrangling & analysis (dplyr, tidyr, readr, etc.)
library(RColorBrewer) # Predefined colour palettes for plots
library(Hmisc)        # Misc. data analysis tools (labelling, summaries, imputation)
library(data.table)   # High-performance data manipulation with data.table

library(R.utils)      # General utilities (compression, argument parsing, etc.)
library(naniar)       # Tools for exploring & visualising missing data
library(geosphere)    # Geodesic distances & spherical geometry for spatial data
library(zoo)          # Time-series infrastructure & rolling-window functions
library(rworldmap)    # World map polygons and mapping utilities
library(gridExtra)    # Arrange multiple ggplot (grid) plots on a page

library(classInt)     # Algorithms for class intervals (e.g. choropleth breaks)
library(DT)           # Interactive HTML tables (DataTables)
library(dvmisc)       # Miscellaneous data & performance utilities
library(gtools)       # Assorted programming tools (mixedsort, permutations, etc.)
library(foreign)      # Import data from Stata, SPSS, SAS, etc.

library(countrycode)  # Convert between country names and codes (ISO, WB, etc.)

library(patchwork)    # Combine ggplot2 plots using + and / operators
library(sf)           # Simple Features for modern vector spatial data
library(rnaturalearth)# Easy access to Natural Earth map data (countries, etc.)
```

## Remove lists
```{r}
## remove lists
rm(list=ls())
```

## Import data for Figure 1 and 2
```{r}
## adgust path as needed
full_df <- readRDS("C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/globsol_df50k_v2_1.rds")
table(full_df$glob_sol)
```

## Plot and export Figure 1
```{r}
df_g <- full_df%>%
mutate(aid_scaled = Hum_plus_ER_aid_tot-cumulative_mean_Hum_plus_ERaid,
        Norm_scaled = NormAgr-cum_mean_NormAgr)



xlim<-mean(df_g$Norm_scaled)
ylim<-mean(df_g$aid_scaled)

# Plot the dataset
p <- ggplot(data=df_g, aes(x = Norm_scaled, y = aid_scaled)) +
 geom_point(aes(colour = factor(GlobSol))) +
 #geom_text(aes(label=iso3c))+
 labs(x = "Identification", y = "Joint sharing") +
 geom_vline(xintercept = 0, linetype = "dashed", alpha=0.5) +
 geom_hline(yintercept = 0, linetype = "dashed", alpha=0.5) +
 scale_x_continuous(breaks=c(min(df_g$Norm_scaled)-14,0,max(df_g$Norm_scaled)),
                     labels=c("Low", "Mean","High"),
                     limits=c(min(df_g$Norm_scaled)-5,max(df_g$Norm_scaled)+5)) +
 scale_y_continuous(breaks=c(0,1500000000),
                    limits=c(-181435843,1500000000),
                     labels=c("Mean","High")) + 
 scale_colour_brewer(palette="Set1",name="Global Solidarity",
                     labels=c("Full",
                              "Symbolic",
                              "Transactional",
                              "Minimal")) +
 theme(panel.background = element_blank(),
        axis.ticks=element_blank(),
         axis.text=element_text(size=10),
       legend.text = element_text(size=10),
        legend.position=c(0.8,0.8))

lab <- df_g %>% 
  mutate(label = ifelse(year == "2014" & iso3c == "CHN", "\nYunnan Earthquake,  China 2014", 
                 ifelse(year == "2002" & iso3c == "AUT", "\nAustria Floods, 2002",
                 ifelse(year == "2005" & iso3c == "PAK", " \nKashmir Earthquake,\n Pakistan 2005", NA)))) %>%
  mutate(label2 = ifelse(year == "2006" & iso3c == "SDN", "Sudan\nFloods,\n2006 ", NA)) %>%
  filter(!is.na(label) | !is.na(label2))

Figure1 <- p +
  geom_text(data = lab, aes(x = Norm_scaled, y = aid_scaled, label = label), hjust = 0.6, vjust = 0.8) +
  geom_text(data = lab, aes(x = Norm_scaled, y = aid_scaled, label = label2), hjust = 1.2) +
  geom_point(data = lab, aes(x = Norm_scaled, y = aid_scaled), shape = 1, size = 3) +
  ggtitle("")


ggsave("C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure1.png", Figure1, width = 8, height = 6, dpi=300)
print(Figure1)
```

## Plot and export Figure 2
```{r}
df<-full_df
# Summarize data: Identify countries with at least one occurrence of each GlobSol value
df_summary <- df %>%
  group_by(iso3c) %>%
  summarise(
    GlobSol1 = any(GlobSol == 1),
    GlobSol2 = any(GlobSol == 2),
    GlobSol3 = any(GlobSol == 3),
    GlobSol4 = any(GlobSol == 4)
  )

# Load world map
world <- ne_countries(scale = "medium", returnclass = "sf")

# Remove Antarctica
world <- world %>% filter(iso_a3 != "ATA")

# Flag countries not in the dataset as NA
world_data <- world %>%
  left_join(df_summary, by = c("iso_a3" = "iso3c")) %>%
  mutate(
    Present = !is.na(GlobSol1) | !is.na(GlobSol2) | !is.na(GlobSol3) | !is.na(GlobSol4), # Check if country is in dataset
    GlobSol1 = ifelse(Present, GlobSol1, NA),
    GlobSol2 = ifelse(Present, GlobSol2, NA),
    GlobSol3 = ifelse(Present, GlobSol3, NA),
    GlobSol4 = ifelse(Present, GlobSol4, NA)
  )

# Define a function to create maps for each GlobSol category
create_map <- function(data, column, title, fill_color) {
  ggplot(data) +
    geom_sf(aes(fill = !!sym(column)), color = "black") + # Black borders
    scale_fill_manual(
      values = c(
        "TRUE" = scales::alpha(fill_color, 1), # Reduce alpha for transparency
        "FALSE" = "white", 
        "NA" = "grey"
      ), # Grey for countries not in dataset
      na.value = "grey"
    ) +
    labs(title = title, fill = NULL) +
    theme_void() +
    theme(
      plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
      legend.position = "none"
    )
}

# Create maps for each GlobSol category with specified colors
map1 <- create_map(world_data, "GlobSol1", "Full Solidarity", "#e41a1c")
map2 <- create_map(world_data, "GlobSol2", "Symbolic Solidarity", "#377eb8")
map3 <- create_map(world_data, "GlobSol3", "Transactional Solidarity", "#4daf4a")
map4 <- create_map(world_data, "GlobSol4", "Minimal Solidarity", "#984ea3")

# Combine maps into a single image with a centered title
Figure2 <- (map3 + map1) / (map4 + map2) +
  plot_annotation(
    title = "",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 16, face = "bold")
    )
  )

# Save or display the final plot
 ggsave("C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure2.png", Figure2, width = 8, height = 6, dpi=300)
print(Figure2)
```



## Import data for Figure 3
```{r}
## adgust path as needed
coeff <- read_xlsx("C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/coeff_Model_main.xlsx")
```

## Plot and export Figure 3
```{r}
## clean df
coeff_plot <- coeff %>% 
  filter(outcome != 4) %>% 
  mutate(
    outcome  = factor(outcome,
                      levels = c(1, 2, 3),
                      labels = c("Full Solidarity",
                                 "Symbolic Solidarity",
                                 "Transactional Solidarity")),
    variable = factor(variable, 
                      levels = c("ln_dis_death", "ln_gdp_lag_1", "nat_rent"),
                      labels = c("Disaster fatalities",
                                 "Economic size",
                                 "Natural rents"))
  )


figure3<-ggplot(coeff_plot,
       aes(x = variable, 
           y = coef, 
           ymin = ll95, 
           ymax = ul95,
           color = outcome)) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_pointrange() +
  coord_flip() +
  facet_wrap(~ outcome, nrow = 1) +
  labs(
    x = NULL,
    y = "",
    title = "Coefficient estimates with 95% confidence intervals"
  ) +
  scale_color_manual(
    values = c(
      "Full Solidarity"          = "#e41a1c",
      "Symbolic Solidarity"      = "#377eb8",
      "Transactional Solidarity" = "#4daf4a"
    )
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"    # <- removes the legend
  )

ggsave("C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure3.png", figure3, width = 8, height = 6, dpi=300)


```

## Import data for Figure 4
```{r}
## 1. Import the raw elasticity table (two-row header, rows for b/ll/ul)
elas_raw <- read_xlsx(
  "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/elas_Model_main.xlsx",
  col_names = FALSE
)
```

## Plot and export Figure 4
```{r}
## 2. Identify the rows for b, ll, ul by their labels in the first column
row_b  <- which(elas_raw[[1]] == "b")
row_ll <- which(elas_raw[[1]] == "ll")
row_ul <- which(elas_raw[[1]] == "ul")

## 3. Take variable names (row 1) and outcome names (row 2), columns 2:…
varnames       <- as.character(elas_raw[1, -1])
outcomes_stata <- as.character(elas_raw[2, -1])

## 4. Build a tidy data frame with coefficients and CIs
elas_long <- tibble(
  variable      = varnames,
  outcome_stata = outcomes_stata,
  coef          = as.numeric(elas_raw[row_b,  -1]),
  ll95          = as.numeric(elas_raw[row_ll, -1]),
  ul95          = as.numeric(elas_raw[row_ul, -1])
)

## 5. Keep only the three IVs of interest and relabel variables + outcomes
elas_plot <- elas_long %>% 
  filter(variable %in% c("ln_dis_death", "ln_gdp_lag_1", "nat_rent")) %>% 
  mutate(
    variable = factor(
      variable,
      levels = c("ln_dis_death", "ln_gdp_lag_1", "nat_rent"),
      labels = c("Disaster fatalities",
                 "Economic size",
                 "Natural rents")
    ),
    outcome = dplyr::case_when(
      outcome_stata == "1bn._predict" ~ "Full Solidarity",
      outcome_stata == "2._predict"   ~ "Symbolic Solidarity",
      outcome_stata == "3._predict"   ~ "Transactional Solidarity",
      outcome_stata == "4._predict"   ~ "Minimal Solidarity",
      TRUE                            ~ outcome_stata
    ),
    outcome = factor(
      outcome,
      levels = c("Full Solidarity",
                 "Symbolic Solidarity",
                 "Transactional Solidarity",
                 "Minimal Solidarity")
    )
  )

## Compute global limits for the coef axis (will become horizontal after coord_flip)
coef_limits <- range(elas_plot$ll95, elas_plot$ul95, na.rm = TRUE)

## 6. Coefficient (elasticity) plot with a common horizontal axis
figure_elas <- ggplot(
  elas_plot,
  aes(x = variable,
      y = coef,
      ymin = ll95,
      ymax = ul95,
      color = outcome)
) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_pointrange() +
  coord_flip() +
  facet_wrap(~ outcome, nrow = 1, scales = "fixed") +  # common scales across facets
  scale_y_continuous(limits = coef_limits) +           # common coef (horizontal) axis
  labs(
    x = NULL,
    y = "",
    title = "Average percentage change in probability (semi-elasticities)"
  ) +
  scale_color_manual(
    values = c(
      "Full Solidarity"          = "#e41a1c",
      "Symbolic Solidarity"      = "#377eb8",
      "Transactional Solidarity" = "#4daf4a",
      "Minimal Solidarity"       = "#984ea3"
    )
  ) +
  theme_bw() +
  theme(
    plot.title      = element_text(hjust = 0.5),
    legend.position = "none"
  )

## 7. (Optional) Save to file
ggsave(
  "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure4.png",
  figure_elas,
  width = 8,
  height = 6,
  dpi = 300
)
```

## Figures 8A, 9A, 10A
```{r}
make_coef_plots <- function(dir_path) {
  
  ## 1. Read all coeff_*.xlsx files in the folder ----
  files <- list.files(
    path       = dir_path,
    pattern    = "^coeff_.*\\.xlsx$",   # adjust if some are .xls
    full.names = TRUE
  )
  
  if (length(files) == 0) {
    stop("No files matching 'coeff_*.xlsx' found in this folder.")
  }
  
  # Base names of files (without extension)
  model_names  <- tools::file_path_sans_ext(basename(files))
  # Strip "coeff_" prefix for internal codes
  model_codes  <- gsub("^coeff_", "", model_names)
  # Prettier labels for plotting (replace "_" with space)
  model_labels <- gsub("_", " ", model_codes)
  
  ## 2. Import and stack all datasets ----
  all_coef <- purrr::map2_dfr(
    .x = files,
    .y = model_labels,
    ~ readxl::read_excel(.x) |>
      dplyr::mutate(model = .y)           # use pretty label as model name in data
  )
  
  # Make sure names are standard
  names(all_coef) <- tolower(names(all_coef))
  # Expecting: outcome, variable, coef, ll95, ul95, model
  
  ## 3. Define custom model order: "Model main" first, then Model 1A–19A ----
  # Work with codes for ordering, not labels
  main_code <- model_codes[grepl("main", model_codes, ignore.case = TRUE)]
  if (length(main_code) == 0) {
    warning("No 'Main' model detected in filenames; using first file as main.")
    main_code <- model_codes[1]
  } else if (length(main_code) > 1) {
    warning("Multiple 'Main' models detected; using the first one.")
    main_code <- main_code[1]
  }
  
  other_codes <- setdiff(model_codes, main_code)
  # Order other models by numeric part in their names (1A, 2A, ..., 19A)
  num_part <- readr::parse_number(other_codes)
  other_codes_ordered <- other_codes[order(num_part)]
  
  # Final order in terms of codes and corresponding labels
  model_codes_ordered  <- c(main_code, other_codes_ordered)
  model_labels_ordered <- gsub("_", " ", model_codes_ordered)
  main_label           <- gsub("_", " ", main_code)   # "Model main"
  
  ## 4. Clean coefficients: drop outcome 4 and enforce factor order ----
  coef_clean <- all_coef |>
    dplyr::filter(outcome != 4) |>
    dplyr::mutate(
      model   = factor(model, levels = model_labels_ordered),
      outcome = factor(outcome)   # levels "1", "2", "3"
    )
  
  ## 5. Helper: one plot per conceptual variable, grouped & dodged by model ----
  plot_for_var <- function(var_names, plot_title) {
    
    dat <- coef_clean |>
      dplyr::filter(variable %in% var_names)
    
    dodge <- ggplot2::position_dodge(width = 0.4)
    
    ggplot2::ggplot(dat, ggplot2::aes(x = model, y = coef, colour = outcome)) +
      ggplot2::geom_hline(yintercept = 0, linetype = "dashed") +
      ggplot2::geom_point(position = dodge) +
      ggplot2::geom_errorbar(
        ggplot2::aes(ymin = ll95, ymax = ul95),
        position = dodge,
        width = 0.2
      ) +
      # Custom colours and legend labels for outcomes
      ggplot2::scale_colour_manual(
        name   = "Outcome",
        breaks = c("1", "2", "3"),
        labels = c("Full solidarity",
                   "Symbolic solidarity",
                   "Transactional solidarity"),
        values = c("1" = "#e41a1c",
                   "2" = "#377eb8",
                   "3" = "#4daf4a")
      ) +
      # Show "Model 1" (bold) instead of "Model main"
      ggplot2::scale_x_discrete(
        labels = function(x) {
          ifelse(
            x == main_label,       # i.e. "Model main"
            "**Model 1**",         # display label
            x
          )
        }
      ) +
      ggplot2::labs(
        title = plot_title,
        x     = "Model",
        y     = "Coefficient size"
      ) +
      ggplot2::theme_bw() +
      ggplot2::theme(
        axis.text.y = ggtext::element_markdown(),   # markdown for model labels
        axis.text.x = ggplot2::element_text()       # numeric coef axis
      ) +
      ggplot2::coord_flip()   # models on the y-axis, coefs on the x-axis
  }
  
  ## 6. Create the three requested plots ----
  # 6.1 Disaster severity: ln_dis_death everywhere
  p_ln_dis_death <- plot_for_var(
    var_names  = "ln_dis_death",
    plot_title = "Coefficients for Disaster fatalities"
  )
  
  # 6.2 Economic size: ln_gdp_lag_1 normally, ln_milper in Models 10A & 12A
  p_ln_gdp_lag_1 <- plot_for_var(
    var_names  = c("ln_gdp_lag_1", "ln_milper"),
    plot_title = "Coefficients for Economic/Military size"
  )
  
  # 6.3 Rents: nat_rent normally, strat in Models 11A & 12A
  p_nat_rent <- plot_for_var(
    var_names  = c("nat_rent", "strat"),
    plot_title = "Coefficients for Natural/Strategic rents"
  )
  
  list(
    ln_dis_death = p_ln_dis_death,
    ln_gdp_lag_1 = p_ln_gdp_lag_1,
    nat_rent     = p_nat_rent
  )
}



```

# Create figures
```{r}
plots <- make_coef_plots(
  "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity"
)
```

# Plot and epxort Fugure 8A
```{r}
# Show each plot:
plots$ln_dis_death

ggsave(
  filename = "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure8A.png",   # or .pdf, .eps, .tiff, ...
  plot     = plots$ln_dis_death,
  width    = 7,   # in inches
  height   = 5,
  dpi      = 300  # for raster formats like png
)
```

# Plot and epxort Fugure 9A
```{r}
plots$ln_gdp_lag_1

ggsave(
  filename = "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure9A.png",   # or .pdf, .eps, .tiff, ...
  plot     = plots$ln_gdp_lag_1,
  width    = 7,   # in inches
  height   = 5,
  dpi      = 300  # for raster formats like png
)
```

# Plot and epxort Fugure 10A
```{r}
plots$nat_rent

ggsave(
  filename = "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure10A.png",   # or .pdf, .eps, .tiff, ...
  plot     = plots$nat_rent,
  width    = 7,   # in inches
  height   = 5,
  dpi      = 300  # for raster formats like png
)
```


## Figures 11A, 12A, 13A
```{r}
make_elas_plots <- function(dir_path) {

  ## 1. Find all elas_*.xls/xlsx files ----
  files <- list.files(
    path       = dir_path,
    pattern    = "^elas_.*\\.xls[x]?$",
    full.names = TRUE
  )

  if (length(files) == 0) {
    stop("No files matching 'elas_*.xls[x]' found in this folder.")
  }

  # Model codes from filenames (e.g. "Model_main", "Model_1A")
  model_names <- tools::file_path_sans_ext(basename(files))
  model_codes <- gsub("^elas_", "", model_names)

  # Pretty labels for plotting: "Model main", "Model 1A", ...
  model_labels <- gsub("_", " ", model_codes)

  ## 2. Read and tidy each elas file ----
  all_elas <- purrr::map2_dfr(
    .x = files,
    .y = model_labels,     # use pretty label inside the data
    ~ {
      raw <- readxl::read_excel(.x, col_names = FALSE)

      # First row: variable names
      header_var     <- as.character(raw[1, ])
      # Second row: outcomes
      header_outcome <- as.character(raw[2, ])

      # First column: row labels ("b", "ll", "ul", ...)
      stat_names <- as.character(raw[[1]])

      b_row  <- which(stat_names == "b")
      ll_row <- which(stat_names == "ll")
      ul_row <- which(stat_names == "ul")

      if (length(b_row) == 0 || length(ll_row) == 0 || length(ul_row) == 0) {
        stop("Could not find rows 'b', 'll', and 'ul' in file: ", .x)
      }

      cols <- 2:ncol(raw)

      tibble::tibble(
        variable = header_var[cols],
        outcome  = header_outcome[cols],
        coef     = as.numeric(unlist(raw[b_row,  cols])),
        ll95     = as.numeric(unlist(raw[ll_row, cols])),
        ul95     = as.numeric(unlist(raw[ul_row, cols])),
        model    = .y          # pretty model label
      )
    }
  )

  ## 3. Define custom model order: Model main, then Model 1A, 2A, ... ----
  main_code <- model_codes[grepl("main", model_codes, ignore.case = TRUE)]
  if (length(main_code) == 0) {
    warning("No 'Main' model detected in filenames; using first file as main.")
    main_code <- model_codes[1]
  } else if (length(main_code) > 1) {
    warning("Multiple 'Main' models detected; using the first one.")
    main_code <- main_code[1]
  }

  other_codes <- setdiff(model_codes, main_code)
  num_part <- readr::parse_number(other_codes)
  other_codes_ordered <- other_codes[order(num_part)]

  model_codes_ordered  <- c(main_code, other_codes_ordered)
  model_labels_ordered <- gsub("_", " ", model_codes_ordered)
  main_label           <- gsub("_", " ", main_code)   # "Model main"

  ## 4. Keep variables of interest (including replacements) and clean factors ----
  elas_clean <- all_elas %>%
    dplyr::mutate(
      variable = tolower(trimws(variable)),
      outcome  = trimws(outcome),
      model    = factor(model, levels = model_labels_ordered)
    ) %>%
    dplyr::filter(
      variable %in% c(
        "ln_dis_death",
        "ln_gdp_lag_1", "ln_milper",   # economic size + replacement
        "nat_rent",    "strat"        # rents + replacement
      ),
      !is.na(coef)
    ) %>%
    dplyr::mutate(
      outcome = factor(
        outcome,
        levels = c("1bn._predict", "2._predict", "3._predict", "4._predict")
      )
    )

  ## 5. Helper to build one plot per conceptual variable (can take multiple var names) ----
  plot_for_var <- function(var_names, plot_title) {

    dat <- elas_clean %>%
      dplyr::filter(variable %in% var_names)

    dodge <- ggplot2::position_dodge(width = 0.4)

    ggplot2::ggplot(dat, ggplot2::aes(x = model, y = coef, colour = outcome)) +
      ggplot2::geom_hline(yintercept = 0, linetype = "dashed") +
      ggplot2::geom_point(position = dodge) +
      ggplot2::geom_errorbar(
        ggplot2::aes(ymin = ll95, ymax = ul95),
        position = dodge,
        width = 0.2
      ) +
      ggplot2::scale_colour_manual(
        name   = "Outcome",
        breaks = c("1bn._predict", "2._predict", "3._predict", "4._predict"),
        labels = c("Full solidarity",
                   "Symbolic solidarity",
                   "Transactional solidarity",
                   "Minimal solidarity"),
        values = c(
          "1bn._predict" = "#e41a1c",  # Full
          "2._predict"   = "#377eb8",  # Symbolic
          "3._predict"   = "#4daf4a",  # Transactional
          "4._predict"   = "#984ea3"   # Minimal 
        )
      ) +
      # Show "Model 1" (bold) instead of "Model main"
      ggplot2::scale_x_discrete(
        labels = function(x) {
          ifelse(
            x == main_label,       # i.e. "Model main"
            "**Model 1**",         # display label
            x
          )
        }
      ) +
      ggplot2::labs(
        title = plot_title,
        x     = "Model",
        y     = "Elasticity"
      ) +
      ggplot2::theme_bw() +
      ggplot2::theme(
        axis.text.y = ggtext::element_markdown()
      ) +
      ggplot2::coord_flip()   # models on y-axis, elasticities on x-axis
  }

  ## 6. Build the three requested plots ----
  # 6.1 Disaster severity: ln_dis_death everywhere
  p_ln_dis_death <- plot_for_var(
    var_names  = "ln_dis_death",
    plot_title = "Semi-elasticities for Disaster fatalities"
  )

  # 6.2 Economic size: ln_gdp_lag_1 normally, ln_milper in Models 10A & 12A
  p_ln_gdp_lag_1 <- plot_for_var(
    var_names  = c("ln_gdp_lag_1", "ln_milper"),
    plot_title = "Semi-elasticities for Economic/Military size"
  )

  # 6.3 Rents: nat_rent normally, strat in Models 11A & 12A
  p_nat_rent <- plot_for_var(
    var_names  = c("nat_rent", "strat"),
    plot_title = "Semi-elasticities for Natural/Strategic rents"
  )

  list(
    ln_dis_death = p_ln_dis_death,
    ln_gdp_lag_1 = p_ln_gdp_lag_1,
    nat_rent     = p_nat_rent
  )
}



```


```{r}
elas_plots <- make_elas_plots(
  "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity"
)
```


```{r}
elas_plots$ln_dis_death    # plot 1: ln_dis_death, 1bn–4._predict, by model

ggsave(
  filename = "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure11A.png",   # or .pdf, .eps, .tiff, ...
  plot     = elas_plots$ln_dis_death ,
  width    = 7,   # in inches
  height   = 5,
  dpi      = 300  # for raster formats like png
)
```


```{r}
elas_plots$ln_gdp_lag_1    # plot 2: ln_gdp_lag_1

ggsave(
  filename = "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure12A.png",   # or .pdf, .eps, .tiff, ...
  plot     = elas_plots$ln_gdp_lag_1 ,
  width    = 7,   # in inches
  height   = 5,
  dpi      = 300  # for raster formats like png
)

```


```{r}
elas_plots$nat_rent        # plot 3: nat_rent

ggsave(
  filename = "C:/Users/marco/Nextcloud/Global Solidarity/Paper on Natural Disasters/STATA dofile/Replication code for The Politics of International Solidarity/Figure13A.png",   # or .pdf, .eps, .tiff, ...
  plot     = elas_plots$nat_rent ,
  width    = 7,   # in inches
  height   = 5,
  dpi      = 300  # for raster formats like png
)
```


